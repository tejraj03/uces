<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Home Page</title>
    <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Material+Symbols+Rounded:opsz,wght,FILL,GRAD@24,400,0,0&icon_names=chevron_left" />
    <link rel="stylesheet" href="homepage.css">
    <link rel="icon" type="image.jpg" href="">
    <link href='https://unpkg.com/boxicons@2.1.4/css/boxicons.min.css' rel='stylesheet'>
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600&display=swap" rel="stylesheet">
</head>
<body>

    <div class="sidebar">
        <div class="logo_content">
            <div class="logo">
                <div class="logo_name">Student Portal</div>
            </div>
        </div>
        <ul class="nav_list">
            <li id="dashboardMenu">
                <a href="#">
                    <i class='bx bxs-grid-alt'></i>
                    <span class="links_name">Dashboard</span>
                </a>
            </li>
        <li id="userMenu">
            <a href="#">
                <i class='bx bx-user'></i>
                <span class="links_name">User</span>
            </a>
        </li>
        <li id="addDropCoursesMenu">
            <a href="#">
                <i class='bx bx-pie-chart'></i>
                <span class="links_name">Add/Drop Courses</span>
            </a>
        </li>
        <li id="settingsMenu">
            <a href="#">
                <i class='bx bxs-cog'></i>
                <span class="links_name">Settings</span>
            </a>
        </li>
    </ul>

        <div class="profile_content">
            <div class="profile">
                <div class="profile_details">
                    <div class="name_job">
                        <div class="name" id="userName">Loading...</div>
                        <div class="rno" id="userId"></div>
                    </div>
                </div>
                <i class='bx bx-log-out' id="log_out"></i>
            </div>
        </div>
    </div>


<!-- Dashboard Welcome Section -->
<div class="dashboard_welcome" id="dashboardWelcome">
    <h1>Welcome, <span id="welcomeName">Loading...</span>!</h1>
    <p>Access your academic information and manage your courses.</p>
</div>

<!-- User Details Section -->
<div class="user_details" id="userDetails" style="display: none;">
    <div class="user_details_card">
        <div class="user_details_header">
            <h2>User Information</h2>
        </div>
        <div class="user_details_body">
            <div class="user_detail_item">
                <span class="detail_label">Name:</span>
                <span class="detail_value" id="detailName">-</span>
            </div>
            <div class="user_detail_item">
                <span class="detail_label">User ID:</span>
                <span class="detail_value" id="detailId">-</span>
            </div>
            <div class="user_detail_item">
                <span class="detail_label">Email:</span>
                <span class="detail_value" id="detailEmail">-</span>
            </div>
            <div class="user_detail_item">
                <span class="detail_label">Role:</span>
                <span class="detail_value" id="detailRole">-</span>
            </div>
        </div>
    </div>
</div>
<!-- Add/Drop Courses Section -->
<div class="courses_section" id="coursesSection" style="display: none;">
    <h2>Available Courses</h2>
    <table id="courses-table">
        <thead>
            <tr>
                <th>Course ID</th>
                <th>Course Name</th>
                <th>Credits</th>
                <th>Actions</th>
            </tr>
        </thead>
        <tbody>
            <!-- Courses will be dynamically loaded here -->
        </tbody>
    </table>
</div>

    <script>
        document.addEventListener("DOMContentLoaded", function () {
// Fetch and display the user's name and ID in the sidebar
// Fetch and display the user's name and ID in the sidebar
fetch('/user-data')
    .then(response => response.json())
    .then(data => {
        if (data.success) {
            document.getElementById("userName").textContent = data.name;
            document.getElementById("userId").textContent = `ID: ${data.user_id}`;
            document.getElementById("welcomeName").textContent = data.name; // Update the dashboard welcome message
        } else {
            document.getElementById("userName").textContent = "Guest";
            document.getElementById("userId").textContent = "";
            document.getElementById("welcomeName").textContent = "Guest";
        }
    })
    .catch(err => {
        console.error("Error fetching user data:", err);
        document.getElementById("userName").textContent = "Error";
        document.getElementById("userId").textContent = "";
        document.getElementById("welcomeName").textContent = "Error";
    });
    const dashboardMenu = document.getElementById("dashboardMenu");
    const userMenu = document.getElementById("userMenu");
    const addDropCoursesMenu = document.getElementById("addDropCoursesMenu");
    const settingsMenu = document.getElementById("settingsMenu");

    const dashboardWelcome = document.getElementById("dashboardWelcome");
    const userDetails = document.getElementById("userDetails");
    const coursesSection = document.getElementById("coursesSection");

    // Function to hide all sections
    function hideAllSections() {
        dashboardWelcome.style.display = "none";
        userDetails.style.display = "none";
        coursesSection.style.display = "none";
    }

    // Show Dashboard
    dashboardMenu.addEventListener("click", function (event) {
        event.preventDefault();
        hideAllSections();
        dashboardWelcome.style.display = "block";
    });

    // Show User Information
    // Show User Information
userMenu.addEventListener("click", function (event) {
    event.preventDefault();
    hideAllSections();
    userDetails.style.display = "block";

    // Fetch and display user data
    fetch('/user-data')
        .then(response => response.json())
        .then(data => {
            if (data.success) {
                document.getElementById("detailName").textContent = data.name;
                document.getElementById("detailId").textContent = `ID: ${data.user_id}`;
                document.getElementById("detailEmail").textContent = data.email;
                document.getElementById("detailRole").textContent = data.role.charAt(0).toUpperCase() + data.role.slice(1); // Capitalize role
            } else {
                alert("Error fetching user information. Please try again.");
            }
        })
        .catch(err => console.error("Error fetching user data:", err));
});    // Handle logout functionality
const logoutIcon = document.getElementById("log_out");
logoutIcon.addEventListener("click", function () {
    fetch('/logout', {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' }
    })
        .then(response => {
            if (response.ok) {
                // Redirect to the login page after successful logout
                window.location.href = "/login";
            } else {
                alert("Error logging out. Please try again.");
            }
        })
        .catch(err => console.error("Error logging out:", err));
});

    // Show Add/Drop Courses Section
    addDropCoursesMenu.addEventListener("click", function (event) {
        event.preventDefault();
        hideAllSections();
        coursesSection.style.display = "block";

        // Fetch and display courses
        fetch('/courses')
            .then(response => response.json())
            .then(data => {
                if (data.success) {
                    const tbody = document.querySelector('#courses-table tbody');
                    tbody.innerHTML = ""; // Clear existing rows
                    data.courses.forEach(course => {
                        tbody.innerHTML += `
                            <tr>
                                <td>${course.course_id}</td>
                                <td>${course.course_name}</td>
                                <td>${course.credits}</td>
                                <td>
                                    <button onclick="submitRequest(${course.course_id}, 'add')">Add</button>
                                    <button onclick="submitRequest(${course.course_id}, 'drop')">Drop</button>
                                </td>
                            </tr>
                        `;
                    });
                }
            })
            .catch(err => console.error("Error fetching courses:", err));
    });

    // Show Settings (if applicable)
    settingsMenu.addEventListener("click", function (event) {
        event.preventDefault();
        hideAllSections();
        alert("Settings page is under construction.");
    });

    // Submit add/drop request
    window.submitRequest = function (courseId, action) {
        fetch('/enrollment', {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify({
                student_id: document.getElementById("userId").textContent.split(": ")[1], // Extract logged-in user ID
                course_id: courseId,
                action: action,
            })
        })
            .then(response => response.text())
            .then(message => alert(message))
            .catch(err => console.error("Error submitting request:", err));
    };
});
 </script>

</body>
</html>